<div class="flex flex-col gap-4">
  <div class="flex gap-4 items-end">
    <mat-form-field appearance="outline" class="flex-1">
      <mat-label>{{
        "transaction-list.select-category" | translate
      }}</mat-label>
      <mat-select [(value)]="selectedCategoryId">
        <mat-option [value]="null">
          {{ "common.none" | translate }}
        </mat-option>
        @for (category of categoryService.allCategories(); track category.id) {
        <mat-option [value]="category.id">
          {{ category.name }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  @if (selectedCategoryId()) {
  <mat-expansion-panel hideToggle>
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{ selectedInterval() }}
        ({{ dateRangeForm.controls.start.value | date : "dd/MM/yyyy" }} -
        {{ dateRangeForm.controls.end.value | date : "dd/MM/yyyy" }})

        <mat-icon class="ml-3">edit</mat-icon>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <div class="flex justify-center items-center gap-2">
      <div class="flex flex-col gap-2">
        <form
          [formGroup]="dateRangeForm"
          (ngSubmit)="onSubmit()"
          class="flex flex-col gap-2"
        >
          <mat-form-field appearance="outline">
            <mat-label>{{ "dashboard.date-range" | translate }}</mat-label>
            <mat-date-range-input [rangePicker]="picker">
              <input
                matStartDate
                placeholder="Start date"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="End date"
                formControlName="end"
                (dateChange)="onSubmit()"
              />
            </mat-date-range-input>

            <mat-datepicker-toggle
              matIconSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </form>

        <div class="flex gap-2">
          <button
            mat-raised-button
            color="secondary"
            type="submit"
            (click)="selectLastNDays(30)"
          >
            {{ "dashboard.select-last-30-days" | translate }}
          </button>

          <button
            mat-raised-button
            color="secondary"
            type="submit"
            (click)="selectLastNDays(90)"
          >
            {{ "dashboard.select-last-90-days" | translate }}
          </button>

          <button
            mat-raised-button
            color="secondary"
            type="submit"
            (click)="selectLastNDays(365)"
          >
            {{ "dashboard.select-last-year" | translate }}
          </button>
        </div>
      </div>
    </div>
  </mat-expansion-panel>

  @if (categoryTransactions().length > 0) {
  <app-card>
    <div class="flex flex-col xl:flex-row justify-center items-center gap-3">
      <apx-chart
        class="w-full"
        [series]="categoryBarChart().series"
        [chart]="categoryBarChart().chart"
        [xaxis]="categoryBarChart().xaxis"
        [dataLabels]="categoryBarChart().dataLabels"
        [plotOptions]="categoryBarChart().plotOptions"
      >
      </apx-chart>
    </div>
  </app-card>
  } @else {
  <div class="text-center text-gray-500 py-4">
    {{ "transaction-list.no-data-for-category" | translate }}
  </div>
  } }
</div>
